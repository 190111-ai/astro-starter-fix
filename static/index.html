<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Astro Starter</title>

        <style>
            body {
                font-family: Arial, Helvetica, sans-serif;
            }
            #container {
                max-width: 800px;
                margin: 0 auto;
            }

            fieldset {
                margin-top: 25px;
                border-radius: 10px;
            }
            h3 {
                margin-top: 0px;
            }
            p {
                margin-block-start: 0.5em;
                margin-block-end: 0.5em;
            }

            .green {
                background-color: #2ac416;
                border-radius: 4px;
                padding: 3px;
            }
            .yellow {
                background-color: #edd91a;
                border-radius: 4px;
                padding: 3px;
            }
            .red {
                background-color: #c41616;
                border-radius: 4px;
                padding: 3px;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <h1>Astro Starter</h1>

            <div id="servers"></div>

            <br /><button id="btnShutdown">Shutdown</button>

            <template id="server">
                <fieldset>
                    <legend class="id"></legend>
                    <h3 class="serverName"></h3>

                    <p>
                        <span>Status: </span><span class="serverStatus"></span>
                    </p>
                    <p>
                        <span>IP/Port: </span><span class="serverAddr"></span>
                    </p>
                    <span>Server Host: </span><span class="serverHost"></span
                    ><br />
                    <span>Server Type: </span><span class="serverType"></span
                    ><br />
                    <span>Owner: </span><span class="serverOwner"></span><br />
                </fieldset>
            </template>
        </div>
    </body>
    <!--  src="script.js"-->
    <script>
        // js here because auto complete

        // shutdown button
        document
            .querySelector("#btnShutdown")
            .addEventListener("click", async (_) => {
                await fetch("/api/shutdown", {
                    method: "POST",
                    body: "",
                });
            });

        const update = async () => {
            const data = await (await fetch("/api/servers")).json();
            //console.log(data);

            const serversDiv = document.querySelector("#servers");
            serversDiv.innerHTML = "";

            /*
            const versionSpan = document.createElement("span");
            versionSpan.innerText = data.latestVersion;
            serversDiv.appendChild(versionSpan);*/

            data.servers.forEach((s) => {
                // server fieldset
                const field = document
                    .querySelector("#server")
                    .content.cloneNode(true);

                // server status
                if (s.status === "stopped") {
                    field.querySelector(".serverStatus").innerText = "Stopped";
                    field.querySelector(".serverStatus").classList.add("red");
                    //
                } else if (s.status === "starting") {
                    field.querySelector(".serverStatus").innerText =
                        "Starting...";
                    field
                        .querySelector(".serverStatus")
                        .classList.add("yellow");
                    //
                } else if (s.status === "running") {
                    field.querySelector(".serverStatus").innerText = "Running";
                    field.querySelector(".serverStatus").classList.add("green");
                    //
                } else if (s.status === "stopping") {
                    field.querySelector(".serverStatus").innerText =
                        "Stopping...";
                    field
                        .querySelector(".serverStatus")
                        .classList.add("yellow");
                }

                // server id
                field.querySelector(".id").innerText = s.id;

                // server name
                field.querySelector(".serverName").innerText = s.name;

                // server address
                field.querySelector(".serverAddr").innerText = s.serverAddr;

                // host type (local/remote)
                field.querySelector(".serverHost").innerText = s.serverType;

                // server type (Individual/Preferred)
                if (s.playfabData)
                    field.querySelector(".serverType").innerText =
                        s.playfabData.Tags.category;

                // owner
                field.querySelector(".serverOwner").innerText = s.owner;

                // TODO
                // whitelist
                // password

                // players
                // saves

                // ability to change whitelist
                // manage players
                // manage saves

                //console.log(s);
                /*
                players: [{…}]
                playfabData: {Region: "USEast", LobbyID: "512496370981876417", BuildVersion: "8", GameMode: "CoopStandard", PlayerUserIds: Array(0), …}
                stats: {build: "1.18.68.0", ownerName: "Konsti219", maxInGamePlayers: 8, playersInGame: 0, playersKnownToGame: 0, …}
                whitelist: false*/

                serversDiv.appendChild(field);
            });
        };
        setInterval(update, 2000);
        update();
    </script>
</html>
